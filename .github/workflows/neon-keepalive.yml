# Keeps Neon database active by running a simple query on a schedule.
# Neon auto-suspends after ~5 minutes of inactivity; this prevents that.
#
# Required: Add your Neon connection string as a repository secret.
#   - Go to Settings → Secrets and variables → Actions
#   - New repository secret: NEON_DATABASE_URL = postgresql://...?sslmode=require
#   (Or use DATABASE_URL if you already have it set for this repo.)

name: Neon DB Keep-Alive

on:
  schedule:
    # Run twice per day (8:00 and 20:00 UTC)
    - cron: '0 8,20 * * *'
  workflow_dispatch: # Allow manual run from Actions tab

jobs:
  keepalive:
    runs-on: ubuntu-latest
    steps:
      - name: Check for database URL
        run: |
          if [ -z "$NEON_DATABASE_URL" ]; then
            echo "::error::NEON_DATABASE_URL secret is not set. Please add it under Settings → Secrets and variables → Actions."
            exit 1
          fi
        env:
          NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}

      - name: Install PostgreSQL client
        run: sudo apt-get update -qq && sudo apt-get install -y -qq postgresql-client > /dev/null

      - name: Ping Neon database
        run: psql "$NEON_DATABASE_URL" -c "SELECT 1 AS ok;" --no-password
        env:
          NEON_DATABASE_URL: ${{ secrets.NEON_DATABASE_URL }}
